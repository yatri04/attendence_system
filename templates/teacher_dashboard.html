{% extends 'base.html' %}
{% block content %}
<div class="row">
  <div class="col-12">
    <h2 class="mb-4">Teacher Dashboard</h2>
    <p class="text-muted mb-4">Select a class to manage attendance and generate QR codes.</p>
  </div>
</div>

<!-- WiFi Network Management -->
<div class="row mb-4">
  <div class="col-12">
    <div class="card">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <h5 class="card-title mb-1">WiFi Network Management</h5>
            <p class="text-muted mb-0">Configure WiFi networks for attendance verification</p>
          </div>
          <div>
            <a href="{{ url_for('manage_wifi_networks') }}" class="btn btn-outline-primary me-2">
              <i class="bi bi-wifi me-2"></i>Manage WiFi Networks
            </a>
            <button type="button" class="btn btn-outline-info" onclick="testWifiConnection()">
              <i class="bi bi-wifi-2 me-2"></i>Test Connection
            </button>
          </div>
        </div>
        <div id="wifi-test-result" class="mt-3"></div>
      </div>
    </div>
  </div>
</div>

<!-- Proxy Lecture Management -->
<div class="row mb-4">
  <div class="col-12">
    <div class="card">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <h5 class="card-title mb-1">Proxy Lecture Management</h5>
            <p class="text-muted mb-0">Generate QR codes for substitute teachers and proxy lectures</p>
          </div>
          <div>
            <a href="{{ url_for('proxy_lecture') }}" class="btn btn-outline-success">
              <i class="bi bi-person-workspace me-2"></i>Proxy Lecture QR
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="row">
  {% if classes %}
    {% for class in classes %}
    <div class="col-lg-4 col-md-6 mb-4">
      <div class="card h-100 shadow-sm">
        <div class="card-body d-flex flex-column">
          <div class="d-flex justify-content-between align-items-start mb-2">
            <h5 class="card-title text-primary mb-0">{{ class.name }}</h5>
            <span class="badge bg-info">{{ class.branch.department.code }}{{ class.branch.code }}</span>
          </div>
          
          <div class="mb-3">
            <div class="row text-center">
              <div class="col-4">
                <div class="border-end">
                  <h6 class="text-muted mb-1">Semester</h6>
                  <span class="badge bg-primary">Sem {{ class.semester.number }}</span>
                </div>
              </div>
              <div class="col-4">
                <div class="border-end">
                  <h6 class="text-muted mb-1">Division</h6>
                  <span class="text-dark">{{ class.division or '-' }}</span>
                </div>
              </div>
              <div class="col-4">
                <h6 class="text-muted mb-1">Students</h6>
                <span class="badge bg-success">{{ class.students|length }}</span>
              </div>
            </div>
          </div>
          
          <div class="mb-3">
            <small class="text-muted">
              <strong>Branch:</strong> {{ class.branch.name }}<br>
              <strong>Department:</strong> {{ class.branch.department.name }}
            </small>
          </div>
          
          <div class="mt-auto">
            <a href="{{ url_for('class_page', class_id=class.id) }}" class="btn btn-primary w-100">
              <i class="bi bi-people-fill me-2"></i>Manage Class
            </a>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  {% else %}
    <div class="col-12">
      <div class="alert alert-info" role="alert">
        <h4 class="alert-heading">No Classes Assigned</h4>
        <p>You haven't been assigned to any classes yet. Please contact the administrator to get assigned to classes.</p>
        <hr>
        <p class="mb-0">Contact your administrator to get assigned to classes.</p>
      </div>
    </div>
  {% endif %}
</div>

<!-- Legacy QR Generation (for backward compatibility) -->
<div class="row mt-5">
  <div class="col-12">
    <div class="card">
      <div class="card-header">
        <h5 class="mb-0">Legacy QR Generation</h5>
      </div>
      <div class="card-body">
        <p class="text-muted">Generate a general QR code (not tied to a specific class).</p>
        <form method="POST" action="{{ url_for('generate_qr') }}">
          <button type="submit" class="btn btn-success">
            <i class="bi bi-qr-code me-2"></i>Generate General QR
          </button>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
function testWifiConnection() {
  const resultDiv = document.getElementById('wifi-test-result');
  resultDiv.innerHTML = '<div class="alert alert-info">Testing WiFi connection...</div>';
  
  fetch('{{ url_for("test_wifi_connection") }}', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    }
  })
  .then(response => response.json())
  .then(data => {
    if (data.ok) {
      resultDiv.innerHTML = `
        <div class="alert alert-success">
          <i class="bi bi-check-circle me-2"></i>
          <strong>WiFi Connected!</strong><br>
          ${data.message}
        </div>
      `;
    } else {
      resultDiv.innerHTML = `
        <div class="alert alert-warning">
          <i class="bi bi-exclamation-triangle me-2"></i>
          <strong>WiFi Not Configured</strong><br>
          ${data.message}
        </div>
      `;
    }
  })
  .catch(error => {
    resultDiv.innerHTML = `
      <div class="alert alert-danger">
        <i class="bi bi-x-circle me-2"></i>
        <strong>Error:</strong> ${error.message}
      </div>
    `;
  });
}
</script>
{% endblock %}
