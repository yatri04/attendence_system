{% extends 'base.html' %}
{% block content %}
<div class="row">
  <div class="col-12">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <div>
        <h2 class="mb-1">WiFi Network Management</h2>
        <p class="text-muted">Configure WiFi networks for attendance verification</p>
      </div>
      <a href="{{ url_for('teacher_dashboard') }}" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left me-2"></i>Back to Dashboard
      </a>
    </div>
  </div>
</div>

<!-- Add New WiFi Network -->
<div class="row mb-4">
  <div class="col-12">
    <div class="card">
      <div class="card-header">
        <h5 class="mb-0">Add New WiFi Network</h5>
      </div>
      <div class="card-body">
        <form method="POST" action="{{ url_for('manage_wifi_networks') }}">
          <input type="hidden" name="action" value="add">
          <div class="row">
            <div class="col-md-4 mb-3">
              <label for="name" class="form-label">Network Name</label>
              <input type="text" class="form-control" id="name" name="name" 
                     placeholder="e.g., Campus WiFi, Classroom Router" required>
            </div>
            <div class="col-md-4 mb-3">
              <label for="router_ip" class="form-label">Router IP Address</label>
              <input type="text" class="form-control" id="router_ip" name="router_ip" 
                     placeholder="e.g., 192.168.1.1" required>
              <div class="form-text">The IP address of the WiFi router</div>
            </div>
            <div class="col-md-4 mb-3">
              <label for="subnet_mask" class="form-label">Subnet Mask (Optional)</label>
              <input type="text" class="form-control" id="subnet_mask" name="subnet_mask" 
                     placeholder="e.g., /24 or 255.255.255.0">
              <div class="form-text">Leave empty for default /24 network</div>
            </div>
          </div>
          <button type="submit" class="btn btn-primary">
            <i class="bi bi-plus-circle me-2"></i>Add WiFi Network
          </button>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Existing WiFi Networks -->
<div class="row">
  <div class="col-12">
    <div class="card">
      <div class="card-header">
        <h5 class="mb-0">Configured WiFi Networks</h5>
      </div>
      <div class="card-body">
        {% if wifi_networks %}
          <div class="table-responsive">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th>Network Name</th>
                  <th>Router IP</th>
                  <th>Subnet Mask</th>
                  <th>Status</th>
                  <th>Created</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                {% for wifi in wifi_networks %}
                <tr>
                  <td>
                    <strong>{{ wifi.name }}</strong>
                  </td>
                  <td>
                    <code>{{ wifi.router_ip }}</code>
                  </td>
                  <td>
                    {% if wifi.subnet_mask %}
                      <code>{{ wifi.subnet_mask }}</code>
                    {% else %}
                      <span class="text-muted">/24 (default)</span>
                    {% endif %}
                  </td>
                  <td>
                    {% if wifi.is_active %}
                      <span class="badge bg-success">Active</span>
                    {% else %}
                      <span class="badge bg-secondary">Inactive</span>
                    {% endif %}
                  </td>
                  <td>
                    <small class="text-muted">{{ wifi.created_at.strftime('%Y-%m-%d %H:%M') }}</small>
                  </td>
                  <td>
                    <div class="btn-group btn-group-sm" role="group">
                      <form method="POST" action="{{ url_for('manage_wifi_networks') }}" class="d-inline">
                        <input type="hidden" name="action" value="toggle">
                        <input type="hidden" name="wifi_id" value="{{ wifi.id }}">
                        <button type="submit" class="btn btn-outline-{{ 'warning' if wifi.is_active else 'success' }} btn-sm">
                          <i class="bi bi-{{ 'pause' if wifi.is_active else 'play' }}"></i>
                          {{ 'Deactivate' if wifi.is_active else 'Activate' }}
                        </button>
                      </form>
                      <form method="POST" action="{{ url_for('manage_wifi_networks') }}" class="d-inline" 
                            onsubmit="return confirm('Are you sure you want to delete this WiFi network?')">
                        <input type="hidden" name="action" value="delete">
                        <input type="hidden" name="wifi_id" value="{{ wifi.id }}">
                        <button type="submit" class="btn btn-outline-danger btn-sm">
                          <i class="bi bi-trash"></i>
                        </button>
                      </form>
                    </div>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <div class="text-center py-4">
            <i class="bi bi-wifi-off display-1 text-muted"></i>
            <h5 class="mt-3 text-muted">No WiFi Networks Configured</h5>
            <p class="text-muted">Add your first WiFi network using the form above to enable WiFi-based attendance verification.</p>
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<!-- Help Section -->
<div class="row mt-4">
  <div class="col-12">
    <div class="card">
      <div class="card-header">
        <h5 class="mb-0">How WiFi Verification Works</h5>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-md-6">
            <h6>For Teachers:</h6>
            <ul>
              <li>Configure WiFi networks by adding router IP addresses</li>
              <li>Students must be connected to one of these networks to mark attendance</li>
              <li>You can activate/deactivate networks as needed</li>
              <li>Test your current connection using the "Test Connection" button</li>
            </ul>
          </div>
          <div class="col-md-6">
            <h6>For Students:</h6>
            <ul>
              <li>Connect to the campus WiFi network</li>
              <li>Scan the QR code to mark attendance</li>
              <li>System will verify you're on the correct network</li>
              <li>Attendance will be rejected if not on campus WiFi</li>
            </ul>
          </div>
        </div>
        <div class="alert alert-info mt-3">
          <i class="bi bi-info-circle me-2"></i>
          <strong>Note:</strong> The system checks if the student's IP address is within the same network as the configured router IP. 
          If no subnet mask is specified, it defaults to a /24 network (e.g., 192.168.1.0/24).
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
